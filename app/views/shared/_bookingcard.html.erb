<div class="cards mt-5">
  <div class="card">
    <h4 class ="card-header">
      <%= "#{booking.ship.name} #{booking.id}" %>
    </h4>
    <div class="card-body d-flex justify-content-between bk-header">
      <%= cl_image_tag booking.ship.photo.key if booking.ship.photo.attached? %>
      <div class="d-flex justify-content-center bk-header-details" >
        <div class="d-flex bk-header-details-block">
          <div>
            <h5>Owner</h5>
            <p class ='card-title'>
              <%= booking.ship.user.nickname.capitalize %>
            </p>
          </div>
          <div>
            <h5>User</h5>
            <p class ='card-title'>
              <%= booking.user.nickname.capitalize %>
            </p>
          </div>
        </div>
        <div class="d-flex bk-header-details-block">
          <div>
            <h5>Starting Date</h5>
            <p>
              <%= booking.date_start %>
            </p>
          </div>
          <div>
            <h5> Ending Date</h5>
            <p>
              <%= booking.date_end %>
            </p>
          </div>
        </div>
      </div>
    </div>
    <div class="card-footer d-flex justify-content-around bk-footer" >
      <div>
        <h5>Status:</h5>
        <p><%=booking.status.capitalize %></p>
      </div>
      <div>
        <h5>Attendants:</h5>
        <p> <%= number_with_delimiter(booking.crew_size, delimiter:'.') %></p>
      </div>
      <div class="total-amount">
        <h5>Amount:</h5>
        <p> <%= number_with_delimiter(booking.total_amount, delimiter:'.') %> ğŸ‘¾</p>
      </div>
      <!-- Cas 1 : Pending/Owner-->
      <% if  booking.ship.user_id == current_user.id && booking.status.downcase == 'pending'%>
        <div class="buttons">
          <%= link_to decline_booking_path(booking), method: :patch, data: { confirm: "Are you sure?"} do %>
            <button class = 'btn btn-danger'>ğŸŒ¸ Decline ğŸŒ¸</button>
          <% end %>
          <%= link_to validate_booking_path(booking), method: :patch, data: { confirm: "Are you sure?"} do %>
            <button class = 'btn btn-success'>ğŸ¾ Accept ğŸ¾</button>
          <% end %>
        <!-- Cas 2 : Paid / Owner + Date check-->
        <% elsif  booking.ship.user_id == current_user.id && booking.status.downcase == 'paid' && booking.date_end <= Date.today%>
        <div class="buttons d-flex justify-content-around">
          <%= link_to close_booking_path(booking), method: :patch do %>
            <button class = 'btn btn-info'>ğŸ” Close ğŸ”</button>
          <% end %>
        </div>
      <!-- Cas 3 : Validated/Owner Validated/User Paid/Owner Paid/User + Date check-->
      <% elsif  ((booking.ship.user_id == current_user.id && ['validated', 'paid'].include?(booking.status.downcase)) || (booking.user_id == current_user.id) && ['pending', 'paid'].include?(booking.status.downcase)) && booking.date_start >= Date.today%>
        <div class="buttons d-flex justify-content-around">
          <%= link_to cancel_booking_path(booking), method: :patch, data: { confirm: "Are you sure?"} do %>
            <button class = 'btn btn-danger'>âœ Cancel âœ</button>
          <% end %>
          <% if booking.user_id == current_user.id %>
            <%= link_to '<i class="far fa-edit"></i>'.html_safe, edit_booking_path(booking), class: "edit pr-2" %>
          <% end %>
      <!-- Cas 4 : Validated status can be paid (or not) by USER -->
        <% elsif  booking.user_id == current_user.id && booking.status.downcase == 'validated'%>
        <div class="buttons d-flex justify-content-around">
          <%= link_to pay_booking_path(booking), method: :patch do %>
            <button class = 'btn btn-info'>ğŸ‘¾ Pay ğŸ‘¾</button>
          <% end %>
        </div>
      <!-- Cas 5 : Validated status can be paid (or not) by USER -->
        <% elsif ['cancelled','closed'].include?(booking.status.downcase)%>
        <div class="buttons d-flex justify-content-around">
          <%= link_to '#', method: :patch do %>
            <button class = 'btn btn-secondary'>ğŸ‘® Request help ğŸ‘®</button>
          <% end %>
        </div>

      <% end %>
    </div>
  </div>
</div>
