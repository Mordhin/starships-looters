
<div class="card-product mb-1">
  <%= cl_image_tag booking.ship.photo.key if booking.ship.photo.attached? %>
  <div class="card-product-info ml-2 w-100">
    <div class="d-flex justify-content-between">
      <div class="card-title"><%= booking.ship.name %></div>
      <% if  booking.ship.user_id == current_user.id && booking.status.downcase == 'pending'%>
        <div class="buttons d-flex justify-content-center">
          <%= link_to decline_booking_path(booking), method: :patch do %>
            <span class="far fa-times-circle btn-decline"></span>
          <% end %>
          <%= link_to validate_booking_path(booking), method: :patch do %>
            <span class="far fa-check-circle btn-accept"></span>
          <% end %>
        </div>
      <% end %>
    </div>
    <div class="d-flex justify-content-around">
      <% unless booking.ship.user.nickname == current_user.nickname  %>
        <div class="to-hide">
          <h2>Owner</h2>
          <div><%= booking.ship.user.nickname.capitalize %></div>
        </div>
      <% end %>
      <% unless booking.user.nickname == current_user.nickname %>
        <div class="to-hide">
          <h2>Requestor</h2>
          <div><%= booking.user.nickname.capitalize %></div>
        </div>
      <% end %>
      <div>
        <h2>Starting Date</h2>
        <div><%= booking.date_start %></div>
      </div>
      <div>
        <h2> Ending Date</h2>
        <div><%= booking.date_end %></div>
      </div>
      <div class="to-hide">
        <h2>Attendants</h2>
        <div> <%= number_with_delimiter(booking.crew_size, delimiter:'.') %></div>
      </div>
      <div>
        <h2>Amount</h2>
        <div> <%= number_with_delimiter(booking.total_amount, delimiter:'.') %> ğŸ‘¾</div>
      </div>
      <div>
        <h2>Status</h2>
        <div><%=booking.status.capitalize %></div>
      </div>
      <!-- Cas 1 : Pending/Owner-->
      <% if  booking.ship.user_id == current_user.id && booking.status.downcase == 'pending'%>
        <div class="buttons">
          <%= link_to decline_booking_path(booking), method: :patch, data: { confirm: "Are you sure?"} do %>
            <button class = 'btn btn-danger'>ğŸŒ¸ Decline ğŸŒ¸</button>
          <% end %>
          <%= link_to validate_booking_path(booking), method: :patch, data: { confirm: "Are you sure?"} do %>
            <button class = 'btn btn-success'>ğŸ¾ Accept ğŸ¾</button>
          <% end %>
        <!-- Cas 2 : Paid / Owner + Date check-->
        <% elsif  booking.ship.user_id == current_user.id && booking.status.downcase == 'paid' && booking.date_end <= Date.today%>
        <div class="buttons d-flex justify-content-around">
          <%= link_to close_booking_path(booking), method: :patch do %>
            <button class = 'btn btn-info'>ğŸ” Close ğŸ”</button>
          <% end %>
        </div>
      <!-- Cas 3 : Validated/Owner Validated/User Paid/Owner Paid/User + Date check-->
      <% elsif  ((booking.ship.user_id == current_user.id && ['validated', 'paid'].include?(booking.status.downcase)) || (booking.user_id == current_user.id) && ['pending', 'paid'].include?(booking.status.downcase)) && booking.date_start >= Date.today%>
        <div class="buttons d-flex justify-content-around">
          <%= link_to cancel_booking_path(booking), method: :patch, data: { confirm: "Are you sure?"} do %>
            <button class = 'btn btn-danger'>âœ Cancel âœ</button>
          <% end %>
          <% if booking.user_id == current_user.id %>
            <%= link_to '<i class="far fa-edit"></i>'.html_safe, edit_booking_path(booking), class: "edit pr-2" %>
          <% end %>
      <!-- Cas 4 : Validated status can be paid (or not) by USER -->
        <% elsif  booking.user_id == current_user.id && booking.status.downcase == 'validated'%>
        <div class="buttons d-flex justify-content-around">
          <%= link_to pay_booking_path(booking), method: :patch do %>
            <button class = 'btn btn-info'>ğŸ‘¾ Pay ğŸ‘¾</button>
          <% end %>
        </div>
      <!-- Cas 5 : Validated status can be paid (or not) by USER -->
        <% elsif ['cancelled','closed'].include?(booking.status.downcase)%>
        <div class="buttons d-flex justify-content-around">
          <%= link_to '#', method: :patch do %>
            <button class = 'btn btn-secondary'>ğŸ‘® Request help ğŸ‘®</button>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div>